# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è email —á–µ—Ä–µ–∑ –∫–æ–¥

## üìã –ß—Ç–æ –±—ã–ª–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

‚úÖ –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è email —á–µ—Ä–µ–∑ 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥ –≤–º–µ—Å—Ç–æ —Å—Å—ã–ª–∫–∏  
‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–¥–∞ –Ω–∞ —Ä–µ–∞–ª—å–Ω—É—é –ø–æ—á—Ç—É —á–µ—Ä–µ–∑ Resend  
‚úÖ –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–¥–∞ —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç —Å–ø–∞–º–∞ (60 —Å–µ–∫—É–Ω–¥)  
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–∞–π–º–µ—Ä –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ  
‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è email –ø—Ä–∏ –≤—Ö–æ–¥–µ  

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
npm install
```

–≠—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç `resend` –ø–∞–∫–µ—Ç, –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω –≤ `package.json`.

### 2. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ Resend

1. –ó–∞–π–¥–∏ –Ω–∞ https://resend.com
2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Å—è (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)
3. –ü–æ–ª—É—á–∏ API KEY –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
4. –î–æ–±–∞–≤—å –≤ `.env`:

```env
RESEND_API_KEY=re_**************
```

### 3. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

–í—ã–ø–æ–ª–Ω–∏ SQL —Å–∫—Ä–∏–ø—Ç `migrations.sql` –≤ Supabase:

```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –∫–æ–¥–æ–≤ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è email
CREATE TABLE IF NOT EXISTS public.email_verifications (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  user_id UUID REFERENCES public.users(id) ON DELETE CASCADE,
  code_hash TEXT NOT NULL,
  expires_at TIMESTAMPTZ NOT NULL,
  last_sent_at TIMESTAMPTZ DEFAULT NOW(),
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- –ò–Ω–¥–µ–∫—Å –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ user_id
CREATE INDEX IF NOT EXISTS idx_email_verifications_user_id ON public.email_verifications(user_id);

-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è email_verified –≤ —Ç–∞–±–ª–∏—Ü—É users (–µ—Å–ª–∏ –µ–≥–æ –µ—â–µ –Ω–µ—Ç)
ALTER TABLE public.users 
ADD COLUMN IF NOT EXISTS email_verified BOOLEAN DEFAULT FALSE;
```

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è –≤ Resend

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `onboarding@resend.dev` (—Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è).

–î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:
1. –í Resend –¥–æ–±–∞–≤—å —Å–≤–æ–π –¥–æ–º–µ–Ω
2. –ò–∑–º–µ–Ω–∏ `from` –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `sendVerificationCode` –≤ `server.js`:

```javascript
from: 'NEON RED <noreply@yourdomain.com>',
```

## üéØ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø–æ–ª–Ω—è–µ—Ç —Ñ–æ—Ä–º—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (—à–∞–≥–∏ 1-4)
2. –ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã:
   - –°–æ–∑–¥–∞—ë—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å `email_verified: false`
   - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥
   - –ö–æ–¥ —Ö–µ—à–∏—Ä—É–µ—Ç—Å—è –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `email_verifications`
   - –ö–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ email —á–µ—Ä–µ–∑ Resend
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —à–∞–≥ 5 (–≤–≤–æ–¥ –∫–æ–¥–∞)

### –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –∫–æ–¥ –Ω–∞ —à–∞–≥–µ 5
2. –°–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
   - –°—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
   - –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è (10 –º–∏–Ω—É—Ç)
   - –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –∫–æ–¥–∞
3. –ï—Å–ª–∏ –≤—Å—ë –û–ö:
   - `email_verified` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ `true`
   - –ö–æ–¥ —É–¥–∞–ª—è–µ—Ç—Å—è
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤–æ–π—Ç–∏

### –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞

1. –ö–Ω–æ–ø–∫–∞ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥ –∑–∞–Ω–æ–≤–æ" –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –Ω–∞ 60 —Å–µ–∫—É–Ω–¥
2. –°—Ç–∞—Ä—ã–π –∫–æ–¥ —É–¥–∞–ª—è–µ—Ç—Å—è
3. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –Ω–æ–≤—ã–π –∫–æ–¥
4. –ö–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ email

### –í—Ö–æ–¥

–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –≤—Ö–æ–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è `email_verified`. –ï—Å–ª–∏ `false`, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞ —Å `needsCodeConfirmation: true`.

## üîí –ó–∞—â–∏—Ç–∞

‚úÖ –ö–æ–¥ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –≤–∏–¥–µ —Ö–µ—à–∞ (bcrypt)  
‚úÖ –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –∫–æ–¥–∞: 10 –º–∏–Ω—É—Ç  
‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞: –Ω–µ —á–∞—â–µ 1 —Ä–∞–∑–∞ –≤ 60 —Å–µ–∫—É–Ω–¥  
‚úÖ –û–¥–∏–Ω –∞–∫—Ç–∏–≤–Ω—ã–π –∫–æ–¥ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è  
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–¥–æ–≤  

## üìß –§–æ—Ä–º–∞—Ç –ø–∏—Å—å–º–∞

–ü–∏—Å—å–º–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ HTML —Ñ–æ—Ä–º–∞—Ç–µ —Å:
- –ö—Ä—É–ø–Ω—ã–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –∫–æ–¥–∞
- –ö–∏–±–µ—Ä–ø–∞–Ω–∫ —Å—Ç–∏–ª–µ–º (–∫—Ä–∞—Å–Ω—ã–π —Ü–≤–µ—Ç, —Ç—ë–º–Ω—ã–π —Ñ–æ–Ω)
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Å—Ä–æ–∫–µ –¥–µ–π—Å—Ç–≤–∏—è

## üêõ –û—Ç–ª–∞–¥–∫–∞

–ï—Å–ª–∏ –ø–∏—Å—å–º–∞ –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç:

1. –ü—Ä–æ–≤–µ—Ä—å `RESEND_API_KEY` –≤ `.env`
2. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏
3. –ü—Ä–æ–≤–µ—Ä—å —Å–ø–∞–º-–ø–∞–ø–∫—É
4. –£–±–µ–¥–∏—Å—å, —á—Ç–æ –¥–æ–º–µ–Ω –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω –≤ Resend (–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)

## üìù API Endpoints

### POST `/api/register`
–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `needsCodeConfirmation: true` –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ.

### POST `/api/confirm-email`
–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ email –∫–æ–¥–æ–º.

**Body:**
```json
{
  "email": "user@example.com",
  "code": "123456"
}
```

### POST `/api/resend-code`
–ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–¥–∞.

**Body:**
```json
{
  "email": "user@example.com"
}
```

## ‚úÖ –ì–æ—Ç–æ–≤–æ!

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤ —Å–∏—Å—Ç–µ–º–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è email –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å.

